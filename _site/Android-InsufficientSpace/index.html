<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  

<meta name="description" content="Fixing &#39;insufficient storage&#39; issue by utilizing external SD card, rooted image and fdisk/mkfs/mount. Describes procedure for CAT B15 phone but can be used with other Android phones as well">


<meta name="keywords" content="android, linux"/>


<!-- Facebook tags -->
<meta property="og:title" content="Fixing annoying Android&#39;s &#39;insufficient storage available&#39; issue">
<meta property="og:type" content="article">
<meta property="og:url" content="http://localhost:4000/vr/Android-InsufficientSpace//">
<meta property="og:image" content="http://localhost:4000/vr/public/images/Android11Gb.png">
<meta property="og:description" content="Fixing &#39;insufficient storage&#39; issue by utilizing external SD card, rooted image and fdisk/mkfs/mount. Describes procedure for CAT B15 phone but can be used with other Android phones as well">
<meta property="og:site_name" content="Vitaly Repin">
<meta property="og:locale" content="en_US">


  <meta property="article:published_time" content="2015-09-03T00:00:00+03:00">
  <meta property="article:author" content="606660677">
  
    <meta property="og:see_also" content="http://localhost:4000/vr/DigitalFree-Moddle/">
  
    <meta property="og:see_also" content="http://localhost:4000/vr/Kekkonen-Estonia-1964/">
  
    <meta property="og:see_also" content="http://localhost:4000/vr/Logstash-filter-external-script/">
  


<meta property="fb:admins" content="606660677">
<!-- <meta property="fb:app_id" content=""> -->


  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Fixing annoying Android's 'insufficient storage available' issue &middot; Vitaly Repin
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/vr/public/css/poole.css">
  <link rel="stylesheet" href="/vr/public/css/syntax.css">
  <link rel="stylesheet" href="/vr/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/vr/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/vr/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p></p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/vr/about">About</a>
    <a class="sidebar-nav-item" href="/vr/hobbies">Hobby projects</a>
    <a class="sidebar-nav-item" href="/vr/tags">Tags</a>
    <a class="sidebar-nav-item" href="/vr/atom.xml">Feed</a>
    <a class="sidebar-nav-item" href="/vr/">Latest posts</a>

  <ul class="posts">  
	  
	   <li>  
		   <span>14 Apr 2016</span> &raquo;  
		   <a href="/vr/DigitalFree-Moddle/">  
		   Course "On the Road to the Free Digital Society" is available in Moodle and IMS Common Cartridge formats now</a>  
	   </li>  
	  
	   <li>  
		   <span>04 Apr 2016</span> &raquo;  
		   <a href="/vr/Kekkonen-Estonia-1964/">  
		   Визит президента Финляндии Кекконена в Эстонию в 1964 году</a>  
	   </li>  
	  
	   <li>  
		   <span>06 Feb 2016</span> &raquo;  
		   <a href="/vr/Logstash-filter-external-script/">  
		   How to incorporate external utility scripts into Logstash Pipeline</a>  
	   </li>  
	  
	   <li>  
		   <span>18 Sep 2015</span> &raquo;  
		   <a href="/vr/CopyrightedMonumentsFinland/">  
		   Copyrighted monuments in Finland. Why Finnish works of art are not widely represented in Wikipedia</a>  
	   </li>  
	  
	   <li>  
		   <span>04 Sep 2015</span> &raquo;  
		   <a href="/vr/Tour-de-Helsinki-2015/">  
		   Tour de Helsinki 2015. Nybörjares intryck från cykelloppet</a>  
	   </li>  
	  
	   <li>  
		   <span>03 Sep 2015</span> &raquo;  
		   <a href="/vr/Android-InsufficientSpace/">  
		   Fixing annoying Android's 'insufficient storage available' issue</a>  
	   </li>  
	  
	   <li>  
		   <span>05 Aug 2015</span> &raquo;  
		   <a href="/vr/Abo-skargard/">  
		   Åbo omnejd. Skärgårdens ringväg med cykel / Saariston Rengastie</a>  
	   </li>  
	  
	   <li>  
		   <span>30 Jul 2015</span> &raquo;  
		   <a href="/vr/IPsec-PacketLeakage/">  
		   [ipsec, iptables, ebtables] How to avoid leakage of packets addressed to/from private IP space</a>  
	   </li>  
	  
	   <li>  
		   <span>09 Jul 2015</span> &raquo;  
		   <a href="/vr/JekyllDeploy/">  
		   How to automatically deploy static web site to the hosting</a>  
	   </li>  
	  
	   <li>  
		   <span>07 Jul 2015</span> &raquo;  
		   <a href="/vr/Bagehot-ECB/">  
		   Is ECB really enemy of the euro? More on Bagehot's rule</a>  
	   </li>  
	  
	   <li>  
		   <span>29 Jun 2015</span> &raquo;  
		   <a href="/vr/JekyllMeta/">  
		   Jekyll: how to add metadata to your site</a>  
	   </li>  
	  
	   <li>  
		   <span>29 Jun 2015</span> &raquo;  
		   <a href="/vr/DisqusAddComments/">  
		   Blog comments = Disqus + Jekyll</a>  
	   </li>  
	  
	   <li>  
		   <span>24 Jun 2015</span> &raquo;  
		   <a href="/vr/Tagging/">  
		   How to implement proper blog tagging with Jekyll</a>  
	   </li>  
	  
	   <li>  
		   <span>23 Jun 2015</span> &raquo;  
		   <a href="/vr/Jekyll-is-cool/">  
		   Jekyll is cool</a>  
	   </li>  
	  
   </ul>

    

 
    
    
      
        
      
    
      
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
    
      
        
      
    
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
  </nav>

  <div class="sidebar-item">
    <p>
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">The content of this site </span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://vrepin.org/blog" property="cc:attributionName" rel="cc:attributionURL">Vitaly Repin</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>,
	  <time datetime="2017-02-12T05:19:33+02:00">2017</time>.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">

        <div class="container">
 <h3 class="masthead-title">
          <h3 class="masthead-title">
            <a href="/vr/" title="Home">Vitaly Repin</a>
            <small>
	
  &nbsp;&nbsp;&nbsp;
  <small><a href="/vr/about/">About</a></small>

  &nbsp;&nbsp;&nbsp;
  <small><a href="/vr/hobbies/">Hobby projects</a></small>

  &nbsp;&nbsp;&nbsp;
  <small><a href="/vr/tags/">Tags</a></small>

  &nbsp;&nbsp;&nbsp;
  <small><a href="/vr/atom.xml">Feed</a></small>

	   </small>
	</h3>
        <h3 class="masthead-title">
           <small>
	     <a href="http://localhost:4000/vr/en">English</a>
	     <a href="http://localhost:4000/vr/sv">Svenska</a>
	     <a href="http://localhost:4000/vr/ru">Русский</a>
	   </small>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Fixing annoying Android's 'insufficient storage available' issue</h1>
  <span class="post-date">03 Sep 2015</span>
  <h1>The root of all evil: ridiculously small amount of free space in &#39;/data&#39; partition</h1>

<p><img src="/vr/public/images/Android11Gb-goal.png" width="50%" alt="Android 'Apps' phone screenshot" align="left" style="margin: 0px 15px"></p>

<p>I am happy <a href="http://www.catphones.com/phones/b15q-smartphone/">CAT B15</a> user. So far it&#39;s the only phone in my possession which survived more than 1 year — it is rugged and therefore
can cope with my lifestyle. But last months it became almost unusable because of &#39;insufficient storage available&#39; message which came out all the time.</p>

<p>The reason is simple — system updates are installed to the &#39;/data&#39; partition which has only 1 GB and they take around half of available space.
I googled and found a lot of ridiculous solutions like &#39;install app X and it will magically solve all your problems including this&#39;, &#39;put all apps to the SD and you will save additional 40M&#39; etc.</p>

<p>These advices sounded like a meaningless loss of time and I decided to fix the real problem which is lack of space in &#39;/data&#39;.
1 GB is ridiculously low limit for modern device with a lot of apps and updates for Android components.</p>

<p>May be my way of fixing the problem can be helpful for other users of Caterpillar phones and other Android phones with similar issues.</p>

<a class="anchor" id="read-more"></a>

<h1>Step 0: Backup everything</h1>

<p>If something goes wrong you can lose your data. Make sure to backup all the valuable content before hacking your device!</p>

<h1>Step 1: order external SD memory card</h1>

<p>Buy the <a href="https://www.sdcard.org/developers/overview/speed_class/">fastest</a> and biggest SD card available. My choice was 32 GB Kingston microSD SDHC UHS-I class 10 memory card. If you want to have
more space, don&#39;t forget to check phone specifications (E.g., CAT B15 supports extended storage up to 32 GB only).</p>

<h1>Step 2: root your Android</h1>

<p>This part is most time-consuming — find rooted firmware compatible with your phone (by the way, the file I&#39;ve found was named <code>CAT_B15_EMEA_DS.1.041.0_Rooted.rar</code>). Don&#39;t be tempted by different
apps which promise you root without re-flashing. This is not what you need.</p>

<p>Start from checking is your phone supported by <a href="http://wiki.cyanogenmod.org/w/Devices">cyanogen</a>. Unfortunately CAT phones are not supported at the moment of writing this post.</p>

<h1>Step 3: install adb tools for Android</h1>

<p>Install <a href="http://developer.android.com/tools/help/adb.html">Android Debug Bridge</a> for you platform. It&#39;s part of <a href="https://developer.android.com/sdk/installing/index.html">Android SDK</a> platform
tools.</p>

<h1>Step 4: partitioning and formatting external SD memory card</h1>

<p>Insert your fresh SD card to the phone and partition it. I&#39;ve made 1 partition for &#39;/data&#39; (11 GB) and another one to be &quot;usual&quot; external mmc (21 GB).</p>

<p>Partitioning is explained in more details <a href="http://forum.xda-developers.com/showthread.php?t=907436">here</a>. I will just list the steps:</p>

<ul>
<li>Launch adb and get shell prompt</li>
<li><code>$ su</code></li>
<li><code># fdisk /dev/block/mmcblk1</code>  Be sure you are repartitioning the proper card! Otherwise you can loose all your data.</li>
<li>Create two primary partition vfat (first!) and Linux (second) and exit fdisk with &#39;w&#39; command.</li>
<li>Format newly created partitions (Again, be very careful with device names!):</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># mke2fs -j -m0 -b4096 -Oextents,uninit_bg,dir_index /dev/block/mmcblk1p2
# mkfs.vfat /dev/block/mmcblk1p1
</code></pre></div>
<p>Reboot the phone and check that freshly created partition became visible by phone and through USB mass storage connection.</p>

<h1>Step 5: Copy old &#39;/data&#39; to the new location</h1>

<p>Now we need to transfer the data from old &#39;/data&#39; partition to the new one. Connect to the phone through adb again and obtain root shell.</p>

<p>First, we need to mount new linux partition to some place, e.g:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># mkdir /storage/sdcard0/DATAANDROID/
# mount -t ext4 /dev/block/mmcblk1p2 /storage/sdcard0/DATAANDROID/
</code></pre></div>
<p>Second, we can copy the contents of &#39;/data&#39; directory to the new location. Prior to doing this, disable phone network connectivity in order to prevent the &#39;/data&#39; content from being
modified while it is being copied to the new location.</p>

<p>Copying itself:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># cd /storage/sdcard0/DATAANDROID/
# cp -rp /data/* .
</code></pre></div>
<h1>Step 6: mount new &#39;/data&#39; during boot</h1>

<p>Now we need to change the mounted device  for &#39;/data&#39; directory. Unfortunately I have not managed to find a straight-forward way to edit &#39;/data&#39; mount point in the timeframe I had for the task
(I will be happy to hear the proper way.  Leave your comments to this post please, I read them). So, I implemented small hack.</p>

<p>We will re-mount &#39;/data&#39; partition in the very early stage of <a href="https://community.freescale.com/docs/DOC-102546">Android bootup process</a> — before zygote is started.</p>

<p>So, launch adb and obtain a root shell again.</p>

<p>First, remount &#39;/system&#39; in read-write mode:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># mount -o remount,rw /system
</code></pre></div>
<p>Rename vold (Android Volume daemon) binary:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># cd /system/bin
# mv vold vold_bin
</code></pre></div>
<p>Create script <code>/system/bin/vold</code> which mounts &#39;/data&#39; again and calls <code>vold_bin</code>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>#!/system/bin/sh

mount -t ext4 /dev/block/mmcblk1p2 /data

/system/bin/vold_bin
</code></pre></div>
<p><em>Make sure it has exactly the same permissions and ownership as original vold binary!</em> Output in my system:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># ls -l vold vold_bin
-rwxr-xr-x root     shell          82 2015-09-05 09:52 vold
-rwxr-xr-x root     shell       91776 2013-03-15 10:16 vold_bin
</code></pre></div>
<h1>It&#39;s done!</h1>

<p>That&#39;s it. Reboot the phone and forget about &#39;insufficient storage available&#39; annoying problem.</p>

<p>If you liked this post, you can
<a href="https://twitter.com/intent/tweet?url=http://localhost:4000/Android-InsufficientSpace/&text=Fixing annoying Android's 'insufficient storage available' issue&via=vitalyrepin" 
   target="_blank">
  share it with your followers</a> 
or 
<a href="https://twitter.com/vitalyrepin">
  follow me on Twitter</a>!</p>

</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.2.1/anchor.min.js"></script>
<script type="text/javascript">
anchors.options.visible = 'hoover';
anchors.options.placement = 'left';
anchors.add();
anchors.remove('.masthead-title');
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/2.3.1/picturefill.min.js"></script>









<a href="/vr/tag/android">#android</a>

<a href="/vr/tag/linux">#linux</a>





<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/vr/DigitalFree-Moddle/">
            Course "On the Road to the Free Digital Society" is available in Moodle and IMS Common Cartridge formats now
            <small>14 Apr 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/vr/Kekkonen-Estonia-1964/">
            Визит президента Финляндии Кекконена в Эстонию в 1964 году
            <small>04 Apr 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/vr/Logstash-filter-external-script/">
            How to incorporate external utility scripts into Logstash Pipeline
            <small>06 Feb 2016</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>


<!-- Analytics begin -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67139587-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- Analytics end -->

 
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'vitalyrepinblog';
    
    var disqus_identifier = '/Android-InsufficientSpace';
    var disqus_title = 'Fixing annoying Android&#39;s &#39;insufficient storage available&#39; issue';
    var disqus_url = 'http://localhost:4000/vr/Android-InsufficientSpace/';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
 

 <footer class="footer">
 <small>
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">The content of this page </span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://vrepin.org/" property="cc:attributionName" rel="cc:attributionURL">Vitaly Repin</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>,
	  <time datetime="2017-02-12T05:19:33+02:00">2017</time>.
	  </small>
</footer>
      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
